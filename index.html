<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="theme-color" content="#0b1220">
<title>Yapay Zeka</title>
<style>
  :root{
    --bg:#0b1220; --ink:#e5e7eb; --muted:#9ca3af; --line:#1f2937;
    --bubble:#111827; --bot:#0b1220; --radius:14px;
    --vh:100vh; /* JS ile gerçek cihaza göre güncellenecek */
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font:16px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",sans-serif}
  body{display:grid;grid-template-rows:1fr}
  .app{
    height:calc(var(--vh) * 100);
    max-width:520px;margin:0 auto;padding:10px;
    display:grid;grid-template-rows:auto 1fr auto;gap:10px;
  }

  .head{display:flex;align-items:center;justify-content:center;gap:8px;
    padding:10px;border:1px solid var(--line);border-radius:14px;background:rgba(255,255,255,.03)}
  .head h1{font-size:15px;margin:0;font-weight:700}

  .chat{
    overflow:auto;padding:12px;border:1px solid var(--line);
    border-radius:14px;background:rgba(255,255,255,.03);
    scroll-behavior:smooth;
    display:block;
  }
  .msg{display:flex;gap:8px;margin:8px 0;align-items:flex-end}
  .msg .bubble{
    max-width:92%; padding:12px 14px;border-radius:12px;
    border:1px solid var(--line); box-shadow:0 8px 24px rgba(0,0,0,.25)
  }
  .bot .bubble{background:var(--bot)}
  .me{justify-content:flex-end}
  .me .bubble{background:var(--bubble)}
  .bubble p{margin:0;white-space:pre-wrap}
  .bubble figure{margin:8px 0 0}
  .bubble img,.bubble svg{
    display:block;width:100%;height:auto;border-radius:10px;border:1px solid var(--line);background:#0a0f1a
  }
  .bubble figcaption{font-size:12px;color:var(--muted);margin-top:6px}

  /* ==== Kompozitör (yazma alanı) ==== */
  .composer{
    position:sticky; bottom:0;
    padding-bottom:max(6px, env(safe-area-inset-bottom));
  }
  .bar{
    display:grid; grid-template-columns:1fr auto; gap:8px;
    border:1px solid var(--line); border-radius:14px; background:#0f172a; padding:8px;
  }
  textarea#text{
    width:100%; resize:none; overflow:auto; border:1px solid var(--line);
    background:var(--bubble); color:var(--ink); outline:none;
    border-radius:12px; padding:12px; line-height:1.4;
    min-height:44px; max-height:32vh; /* 1–6 satır civarı */
    font:inherit;
  }
  button#send{
    min-width:92px; min-height:44px; padding:12px 14px; border-radius:12px;
    border:1px solid var(--line); background:#111827; color:var(--ink); cursor:pointer;
  }
  button#send:active{transform:translateY(1px)}
  button#send[disabled]{opacity:.6; cursor:default}
</style>
<style>
  /* ... mevcut stilin altına ekle */
  .brand {
    display:flex; align-items:center; gap:10px;
  }
  .brand .logo {
    width:28px; height:28px; flex:0 0 28px;
  }
  .brand .wordmark {
    font-size:15px; font-weight:800; letter-spacing:.2px; margin:0;
  }
</style>

</head>
<body>
<div class="app">
 <div class="head">
  <div class="brand" aria-label="Mindora">
    <img class="logo" src="assets/mindora-logo.png" alt="Mindora logo" width="28" height="28">
    <h1 class="wordmark">Mindora</h1>
  </div>
</div>

  <div id="chat" class="chat"></div>

  <div class="composer">
    <div class="bar">
      <textarea id="text" rows="1" placeholder="Herhangi bir şey sor" autocomplete="off" inputmode="text"></textarea>
      <button id="send" aria-label="Gönder">Gönder</button>
    </div>
  </div>
</div>

<script>
/* ====== Gerçek cihaz yüksekliği & klavye (iOS/Android) ====== */
function setVH(){
  const h = window.visualViewport ? window.visualViewport.height : window.innerHeight;
  document.documentElement.style.setProperty('--vh', (h/100));
}
setVH();
window.addEventListener('resize', setVH);
if (window.visualViewport){
  visualViewport.addEventListener('resize', setVH);
  visualViewport.addEventListener('scroll', setVH);
}

/* ========== Manifest'i tek dosyada üret (PWA/ana ekrana ekleme) ========== */
(function registerManifest(){
  const iconSvg = size => `<?xml version="1.0"?>
  <svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 64 64">
    <rect width="64" height="64" fill="#0b1220"/>
    <circle cx="32" cy="32" r="28" fill="#0b1220" stroke="#60a5fa" stroke-width="2"/>
    <path d="M16 44 V20 L32 36 L48 20 V44" fill="none" stroke="#e5e7eb" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="16" cy="20" r="2" fill="#60a5fa"/>
    <circle cx="32" cy="36" r="2" fill="#60a5fa"/>
    <circle cx="48" cy="20" r="2" fill="#60a5fa"/>
  </svg>`;

  const manifest = {
    name: "Mindora — Mini Chat",
    short_name: "Mindora",
    start_url: ".",
    display: "standalone",
    background_color: "#0b1220",
    theme_color: "#0b1220",
    icons: [192,512].map(sz=>({
      src: 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(iconSvg(sz)),
      sizes: sz+'x'+sz,
      type: 'image/svg+xml'
    }))
  };

  const blob = new Blob([JSON.stringify(manifest)], {type:'application/manifest+json'});
  const url = URL.createObjectURL(blob);
  const link = document.createElement('link');
  link.rel = 'manifest'; link.href = url; document.head.appendChild(link);
})();
/* ================== Yardımcılar ================== */
const chatEl = document.getElementById('chat');
const textEl = document.getElementById('text');
const sendEl = document.getElementById('send');

function esc(s){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]))}
function toBottom(){ chatEl.scrollTop = chatEl.scrollHeight; }
function bubble(who, html){
  const wrap = document.createElement('div');
  wrap.className = `msg ${who}`;
  const b = document.createElement('div');
  b.className = 'bubble';
  if(typeof html === 'string') b.innerHTML = `<p>${html}</p>`; else b.appendChild(html);
  wrap.appendChild(b); chatEl.appendChild(wrap); toBottom();
}
function me(t){ bubble('me', esc(t)); }

/* Otomatik büyüyen textarea */
function autoGrow(){
  textEl.style.height = 'auto';
  const h = Math.min(textEl.scrollHeight, Math.round(window.innerHeight*0.32));
  textEl.style.height = h + 'px';
  toBottom();
}
textEl.addEventListener('input', autoGrow);

/* Enter = gönder, Shift+Enter = yeni satır */
textEl.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && !e.shiftKey){
    e.preventDefault();
    send();
  }
});

/* Normalizasyon */
function normalize(t){
  try{ t = t.normalize('NFD').replace(/\p{Diacritic}/gu,''); }catch(_){}
  return t.toLowerCase()
          .replace(/[ç]/g,'c').replace(/[ğ]/g,'g').replace(/[ı]/g,'i')
          .replace(/[ö]/g,'o').replace(/[ş]/g,'s').replace(/[ü]/g,'u')
          .replace(/[^a-z0-9\s]/g,' ')
          .replace(/\s+/g,' ').trim();
}

/* ============ Inline görseller (SVG) ============ */
function staffSVG(){
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('viewBox','0 0 300 600'); svg.setAttribute('role','img');
  svg.innerHTML = `
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#d4af37"/>
        <stop offset="60%" stop-color="#b08d2b"/>
        <stop offset="100%" stop-color="#7a5d1a"/>
      </linearGradient>
      <radialGradient id="gem" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#c7f9cc"/>
        <stop offset="100%" stop-color="#1f6f5b"/>
      </radialGradient>
    </defs>
    <rect x="138" y="80" width="24" height="440" rx="12" fill="url(#g)"/>
    <g stroke="#3a2a0d" stroke-width="2" opacity=".35" fill="none">
      ${Array.from({length:12}).map((_,i)=>`<path d="M140 ${100+i*30} q20 8 40 0"/>`).join('')}
    </g>
    <g transform="translate(150,70)">
      <path d="M -70 0 q 30 -30 70 -30 q 40 0 70 30 q -30 30 -70 30 q -40 0 -70 -30 z" fill="url(#g)" stroke="#3a2a0d" />
      <circle cx="0" cy="0" r="10" fill="url(#gem)" stroke="#0b3330"/>
      <path d="M-35 -5 l-20 -10 l10 20 z" fill="#2a200a" opacity=".6"/>
      <path d="M35 -5 l20 -10 l-10 20 z" fill="#2a200a" opacity=".6"/>
    </g>
    <ellipse cx="150" cy="520" rx="16" ry="8" fill="#6e5320"/>
  `;
  return svg;
}
function vasePortraitSVG(){
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('viewBox','0 0 600 600');
  svg.innerHTML = `
    <rect width="600" height="600" fill="#0a0f1a"/>
    <g transform="translate(140,140)">
      <circle cx="160" cy="160" r="160" fill="#c46b2a"/>
      <path d="M80 120 q40 -70 120 -70 q80 0 120 70 q-40 70 -120 70 q-80 0 -120 -70 z" fill="#d67d3b"/>
      <path d="M120 210 q80 40 160 0" stroke="#3b2715" stroke-width="10" fill="none"/>
      <path d="M110 240 q40 30 200 30" stroke="#3b2715" stroke-width="8" fill="none"/>
      <circle cx="210" cy="160" r="8" fill="#3b2715"/>
      <path d="M240 170 q20 10 30 0" stroke="#3b2715" stroke-width="8" fill="none"/>
      <path d="M150 90 q30 -40 60 -45 q30 12 60 45" stroke="#3b2715" stroke-width="10" fill="none"/>
      <path d="M160 60 l-40 30 l20 0 z M260 60 l40 30 l-20 0 z" fill="#d67d3b"/>
    </g>`;
  return svg;
}
function figureWithCaption(node, caption){
  const fig = document.createElement('figure'); fig.appendChild(node);
  const fc = document.createElement('figcaption'); fc.textContent = caption; fig.appendChild(fc); return fig;
}

/* ============ Cevaplar ============ */
function answer_karun_nedir(){
  return "Karun, Türkçede çok zengin kişi için kullanılan bir addır (\"Karun kadar zengin\"). Efsanevi figür tarihsel olarak Lidya kralı Kroisos’la özdeşleştirilir.";
}
function answer_karun_kimdir(){
  return "Karun diye anılan kişi, MÖ 6. yüzyılda Batı Anadolu’daki Lidya Krallığı’nın hükümdarı **Kroisos**’tur; başkent Sardes, ünü zenginlik ve tapınak armağanlarıyla gelir.";
}
function answer_asa_nasil(){
  const html = document.createElement('div');
  html.innerHTML = `<p><strong>Kısa tanım:</strong> Kaynaklarda birebir tanımı yok; <em>Karun Hazinesi</em> etrafındaki anlatılardan esinle betimlenir.
• <em>Malzeme</em>: altın kaplama bronz/saf altın.
• <em>Motif</em>: çift başlı kartal, aslan pençesi ya da yılan.
• <em>Boy</em>: 120–140 cm; spiral ve yazıt bezemeleri.
• <em>Mitolojik varyant</em>: uçta taş kakmalar (zümrüt, yakut, lapis).
• <em>Ağırlık notu</em>: som altın ve 3–5 cm çap için yaklaşık 20–30 kg.</p>`;
  return html;
}
function answer_gorsel(){
  const fig = document.createElement('figure');
  const img = new Image();
  img.src = 'assets/karun.png';  /* Kendi görselin — URL de verebilirsin */
  img.alt = 'Karun (Kroisos) portresi'; img.loading = 'lazy';
  fig.appendChild(img);
  const cap = document.createElement('figcaption');
  cap.textContent = 'İsteğine uygun gerçek bir görsel bulamadım ama AI yardımıyla bir görsel ürettim.';
  fig.appendChild(cap);
  img.onerror = ()=>{
    fig.innerHTML=''; fig.appendChild(vasePortraitSVG());
    const c=document.createElement('figcaption'); c.textContent='Karun — temsili (SVG)'; fig.appendChild(c);
  };
  return fig;
}
function answer_asa_nerede(){
  return "Doğrulanmış tekil bir ‘Karun’un asası’ eseri yoktur. Obje, efsanelerde ‘Karun Hazinesi’ bağlamında anılır; bu yüzden gerçek dünyada kesin bir konum verilemez. Senaryoda yeri kurgusaldır.";
}

/* ============ Soru eşleştirme ============ */
function findAnswer(text){
  const n = normalize(text);
  if(/\b(karun|kroisos)\b.*\b(nedir|ne demek)\b/.test(n)) return answer_karun_nedir();
  if(/\b(karun|kroisos)\b.*\b(kimdir|kim)\b/.test(n)) return answer_karun_kimdir();
  if(/\b(asa|asasi|asanin)\b.*\b(nasil|neye benzer)\b/.test(n) || /\b(karunun)\s+(asasi).*(nasil)/.test(n)) return answer_asa_nasil();
  if(/\b(gorsel|gorseli var mi|foto|fotograf|resim|portre)\b/.test(n)) return answer_gorsel();
  if(/\b(asa|asasi|asanin)\b.*\b(nerede|yeri|nereye)\b/.test(n)) return answer_asa_nerede();
  return "Bu soruna cevap veremem çünkü Kadri'den öğrendiklerim bunlar :D";
}

/* ============ Akış ============ */
function send(){
  const t = textEl.value.trim(); if(!t) return;
  sendEl.disabled = true;
  me(t); textEl.value=''; autoGrow();
  setTimeout(()=>{
    const r = findAnswer(t);
    (typeof r === 'string') ? bubble('bot', r) : bubble('bot', r);
    sendEl.disabled = false; textEl.focus();
  }, 140);
}
sendEl.onclick = send;

/* İlk yüklemede alanı oturt & karşılama */
autoGrow();
bubble('bot','Merhaba! Neyi merak ediyorsun?');
</script>
</body>
</html>
